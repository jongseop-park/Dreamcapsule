<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dreamcapsule.project.apps.holiday.mapper.HolidayMapper">

    <select id="findAll" resultType="HolidayVO">
        SELECT * FROM HOLIDAY_INFO_TB ORDER BY ${VALUE} ${TYPE}
    </select>

    <select id="findByInfoValue" resultType="HolidayVO">
        SELECT * FROM HOLIDAY_INFO_TB WHERE SEQ = #{SEQ}
    </select>
    <select id="findByValue" resultType="HolidayVO">
        SELECT SEQ,
            USER_NUM,
            HOLIDAY_YEAR,
            HOLIDAY_MONTH,
            HOLIDAY_TYPE,
            HOLIDAY_DATE,
            NOTE,
            TO_CHAR(APPLICATION_TIME,'YYYY.MM.DD (dy) HH24:MI') AS APPLICATION_TIME,
            STATE_YSN,
            USE_HOLIDAY,
            REPLY FROM HOLIDAY_TB WHERE USER_NUM = #{SEQ} AND HOLIDAY_YEAR = #{YEAR} AND HOLIDAY_MONTH = #{MONTH}
    </select>

    <select id="findByName" resultType="HolidayVO">
        SELECT * FROM HOLIDAY_TB WHERE NAME = #{NAME}
    </select>

    <select id="findTask" resultType="HolidayVO">
        SELECT DISTINCT TASK FROM HOLIDAY_INFO_TB
    </select>

    <select id="findYear" resultType="HolidayVO">
        SELECT DISTINCT HOLIDAY_YEAR FROM HOLIDAY_TB ORDER BY HOLIDAY_YEAR DESC
    </select>

    <select id="findUse" resultType="HolidayVO">
        SELECT SUM(USE_HOLIDAY) AS USE_HOLIDAY FROM HOLIDAY_TB WHERE USER_NUM = #{NUM} AND HOLIDAY_MONTH = #{MONTH} AND HOLIDAY_YEAR = #{YEAR}
    </select>

    <select id="findUseYear" resultType="Long">
        SELECT SUM(USE_HOLIDAY) AS USE_HOLIDAY FROM HOLIDAY_TB WHERE USER_NUM = #{SEQ} AND HOLIDAY_YEAR = #{YEAR} AND STATE_YSN = 'Y'
    </select>

    <select id="findUseTask" resultType="HolidayVO">
        SELECT SUM(USE_HOLIDAY) AS USE_HOLIDAY
        FROM HOLIDAY_TB
         WHERE USER_NUM = (SELECT seq from HOLIDAY_INFO_TB WHERE TASK = #{TASK})
         AND HOLIDAY_MONTH = #{MONTH}
         AND HOLIDAY_YEAR = #{YEAR}
    </select>

    <select id="findTaskMember" resultType="HolidayVO">
        SELECT * FROM HOLIDAY_INFO_TB WHERE TASK = #{TASK}
    </select>

    <update id="detailsUpdate">
        UPDATE HOLIDAY_TB SET STATE_YSN=#{STATE}, REPLY = #{REPLY}, MOD_DT = SYSDATE WHERE SEQ = #{SEQ}
    </update>

    <insert id="holidayInsert">
        INSERT INTO
        HOLIDAY_TB(SEQ,USER_NUM,HOLIDAY_TYPE,HOLIDAY_YEAR,HOLIDAY_MONTH,HOLIDAY_DATE,NOTE,USE_HOLIDAY,STATE_YSN)
         VALUES(HOLIDAY_SEQ.NEXTVAL,#{USER_NUM},#{HOLIDAY_TYPE},#{HOLIDAY_YEAR},#{HOLIDAY_MONTH},#{HOLIDAY_DATE},#{NOTE},#{USE_HOLIDAY},'Y')
    </insert>
</mapper>