<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dreamcapsule.project.apps.report.mapper.ReportMapper">
    <resultMap type="ReportVO" id="ReportMap">
        <id property="sequence" column="SEQ" />
        <result property="registerDate" column="REG_DT" />
        <result property="empName" column="EMP_NM" />
        <result property="hireDate" column="HIRE_DT" />
        <result property="workDate" column="WORK_DT" />
        <result property="workTime" column="WORK_TM" />
        <result property="payVacationTime" column="PAY_VAC_TM" />
        <result property="overtimeWorkTime" column="OT_WORK_TM" />
        <result property="planOvertime" column="PL_OT_TM" />
        <result property="actualOvertime" column="AC_OT_TM" />
        <result property="vacationCount" column="VC_COUNT" />
        <result property="vacationTotal" column="VC_TOTAL" />
        <result property="lateCount" column="LATE_COUNT" />
        <result property="absentCount" column="AB_COUNT" />
    </resultMap>

    <select id="reportList" resultType="com.dreamcapsule.project.domain.ReportVO" resultMap="ReportMap">
         SELECT
    emp_nm,
    to_char(hire_dt, 'YYYY-MM-DD') AS hire_dt,
    work_dt,
    work_tm,
    pay_vac_tm,
    ot_work_tm,
    pl_ot_tm,
    ac_ot_tm,
    vc_count,
    vc_total,
    late_count,
    ab_count
FROM
    report_tb
ORDER BY
    seq
    </select>

    <select id="countSearch" resultType="int">
            SELECT
    COUNT(seq)
            FROM
    report_tb
            WHERE
    emp_nm LIKE '%'
                || #{keyword} || '%' and
            (REG_DT between TO_DATE(#{startDate}) and TO_DATE(#{endDate}) )
    </select>

    <select id="listSearch" resultType="com.dreamcapsule.project.domain.ReportVO" resultMap="ReportMap">
       SELECT
    seq,
    reg_dt,
    emp_nm,
    to_char(hire_dt, 'YYYY-MM-DD') AS hire_dt,
    work_dt,
    work_tm,
    pay_vac_tm,
    ot_work_tm,
    pl_ot_tm,
    ac_ot_tm,
    vc_count,
    vc_total,
    late_count,
    ab_count
FROM ( SELECT
    seq,
    reg_dt,
    emp_nm,
    hire_dt,
    work_dt,
    work_tm,
    pay_vac_tm,
    ot_work_tm,
    pl_ot_tm,
    ac_ot_tm,
    vc_count,
    vc_total,
    late_count,
    ab_count,
    row_number() over
(
ORDER BY
    seq ${order}) as rNum from REPORT_TB
             where EMP_NM like '%' || #{keyword} || '%'
             and (REG_DT BETWEEN to_date(#{startDate}) AND to_date(#{endDate})))
             where rNum between ${rowStart} and ${rowEnd} order by ${orderKeyword} ${order}
            </select>


    <select id="reportExcel" resultType="com.dreamcapsule.project.domain.ReportVO">
    SELECT
        seq,
    reg_dt as registerDate,
    emp_nm as empName,
    to_char(hire_dt, 'YYYY-MM-DD') AS hireDate,
    work_dt as workDate,
    work_tm as workTime,
    pay_vac_tm as payVacationTime,
    ot_work_tm as overtimeWorkTime,
    pl_ot_tm as planOvertime,
    ac_ot_tm as actualOvertime,
    vc_count as vacationCount,
    vc_total as vacationTotal,
    late_count as lateCount,
    ab_count as absentCount
FROM ( SELECT
    seq,
    reg_dt,
    emp_nm,
    hire_dt,
    work_dt,
    work_tm,
    pay_vac_tm,
    ot_work_tm,
    pl_ot_tm,
    ac_ot_tm,
    vc_count,
    vc_total,
    late_count,
    ab_count,
    row_number() over
(
ORDER BY
    ${orderKeyword} ${order}) as rNum from REPORT_TB
             where EMP_NM like '%' || #{keyword} || '%'
             and (REG_DT BETWEEN to_date(#{startDate}) AND to_date(#{endDate})))
    </select>
</mapper>